<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>æ¯æ—¥å­¦ä¹ åŠ©æ‰‹ - AI æ™ºèƒ½å­¦ä¹ å†…å®¹æ¨è</title>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
			rel="stylesheet"
		/>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			:root {
				--primary-color: #667eea;
				--secondary-color: #764ba2;
				--accent-color: #f093fb;
				--text-dark: #2d3748;
				--text-light: #718096;
				--bg-light: #f7fafc;
				--bg-white: #ffffff;
				--border-color: #e2e8f0;
				--success-color: #48bb78;
				--warning-color: #f6ad55;
				--error-color: #f56565;
				--gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				--gradient-card: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
				--shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
				--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
				--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
				--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
			}

			body {
				font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
					sans-serif;
				line-height: 1.6;
				color: var(--text-dark);
				background: var(--bg-light);
			}

			.landing-page {
				min-height: 100vh;
				background: var(--gradient-primary);
				position: relative;
				overflow: hidden;
			}

			.landing-page::before {
				content: "";
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
				animation: float 6s ease-in-out infinite;
			}

			@keyframes float {
				0%,
				100% {
					transform: translateY(0px) rotate(0deg);
				}
				50% {
					transform: translateY(-20px) rotate(1deg);
				}
			}

			.landing-container {
				position: relative;
				z-index: 1;
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem;
				min-height: 100vh;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				text-align: center;
			}

			.hero-section {
				color: white;
				margin-bottom: 4rem;
			}

			.hero-title {
				font-size: 3.5rem;
				font-weight: 700;
				margin-bottom: 1.5rem;
				background: linear-gradient(45deg, #fff, #f0f8ff);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				animation: slideInDown 1s ease-out;
			}

			.hero-subtitle {
				font-size: 1.25rem;
				margin-bottom: 2rem;
				opacity: 0.9;
				animation: slideInUp 1s ease-out 0.2s both;
			}

			.hero-description {
				font-size: 1.1rem;
				margin-bottom: 3rem;
				opacity: 0.8;
				max-width: 600px;
				animation: fadeIn 1s ease-out 0.4s both;
			}

			@keyframes slideInDown {
				from {
					opacity: 0;
					transform: translateY(-50px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes slideInUp {
				from {
					opacity: 0;
					transform: translateY(50px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}

			.features-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
				gap: 2rem;
				margin-bottom: 3rem;
				animation: slideInUp 1s ease-out 0.6s both;
			}

			.feature-card {
				background: rgba(255, 255, 255, 0.1);
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 16px;
				padding: 2rem;
				text-align: center;
				transition: all 0.3s ease;
				color: white;
			}

			.feature-card:hover {
				transform: translateY(-5px);
				background: rgba(255, 255, 255, 0.15);
				box-shadow: var(--shadow-xl);
			}

			.feature-card:active {
				transform: translateY(-2px);
			}

			.feature-icon {
				font-size: 3rem;
				margin-bottom: 1rem;
				background: var(--gradient-card);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}

			.feature-title {
				font-size: 1.25rem;
				font-weight: 600;
				margin-bottom: 0.5rem;
			}

			.feature-desc {
				opacity: 0.8;
				font-size: 0.95rem;
			}

			.cta-button {
				background: var(--gradient-card);
				color: white;
				border: none;
				padding: 1rem 2.5rem;
				font-size: 1.1rem;
				font-weight: 600;
				border-radius: 50px;
				cursor: pointer;
				transition: all 0.3s ease;
				box-shadow: var(--shadow-lg);
				animation: pulse 2s infinite;
			}

			.cta-button:hover {
				transform: translateY(-2px);
				box-shadow: var(--shadow-xl);
				animation: none;
			}

			@keyframes pulse {
				0% {
					box-shadow: 0 0 0 0 rgba(240, 147, 251, 0.4);
				}
				70% {
					box-shadow: 0 0 0 10px rgba(240, 147, 251, 0);
				}
				100% {
					box-shadow: 0 0 0 0 rgba(240, 147, 251, 0);
				}
			}

			.app-page {
				display: none;
				min-height: 100vh;
				background: var(--bg-light);
			}

			.app-header {
				background: var(--bg-white);
				border-bottom: 1px solid var(--border-color);
				padding: 1rem 0;
				box-shadow: var(--shadow-sm);
				position: sticky;
				top: 0;
				z-index: 100;
			}

			.header-container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 0 2rem;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.app-logo {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				font-size: 1.5rem;
				font-weight: 700;
				background: var(--gradient-primary);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
			}

			.status-indicator {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.5rem 1rem;
				border-radius: 50px;
				font-size: 0.875rem;
				font-weight: 500;
			}

			.status-online {
				background: rgba(72, 187, 120, 0.1);
				color: var(--success-color);
			}

			.status-offline {
				background: rgba(245, 101, 101, 0.1);
				color: var(--error-color);
			}

			.app-main {
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem;
			}

			.learning-tabs {
				display: flex;
				gap: 1rem;
				margin-bottom: 2rem;
				flex-wrap: wrap;
			}

			.tab-button {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				padding: 0.75rem 1.5rem;
				border: 2px solid var(--border-color);
				background: var(--bg-white);
				border-radius: 50px;
				cursor: pointer;
				transition: all 0.3s ease;
				font-weight: 500;
				color: var(--text-light);
			}

			.tab-button.active {
				background: var(--gradient-primary);
				border-color: transparent;
				color: white;
				transform: translateY(-2px);
				box-shadow: var(--shadow-md);
			}

			.tab-button:hover:not(.active) {
				border-color: var(--primary-color);
				transform: translateY(-1px);
			}

			.learning-content {
				display: block;
			}

			.content-card {
				background: var(--bg-white);
				border-radius: 16px;
				padding: 2rem;
				box-shadow: var(--shadow-md);
				border: 1px solid var(--border-color);
			}

			.content-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 1.5rem;
				padding-bottom: 1rem;
				border-bottom: 1px solid var(--border-color);
				gap: 2rem;
			}

			.header-actions {
				display: flex;
				gap: 0.75rem;
				align-items: center;
			}

			.content-type {
				font-size: 1.25rem;
				font-weight: 600;
				color: var(--text-dark);
			}

			.refresh-button,
			.speak-button {
				background: rgba(102, 126, 234, 0.1);
				color: var(--primary-color);
				border: 2px solid rgba(102, 126, 234, 0.2);
				padding: 0.5rem 1rem;
				border-radius: 12px;
				cursor: pointer;
				transition: all 0.3s ease;
				font-weight: 500;
				display: flex;
				align-items: center;
				gap: 0.5rem;
				font-size: 0.9rem;
			}

			.refresh-button:hover:not(:disabled),
			.speak-button:hover:not(:disabled) {
				background: rgba(102, 126, 234, 0.15);
				border-color: rgba(102, 126, 234, 0.4);
				transform: translateY(-1px);
				box-shadow: var(--shadow-sm);
			}

			.refresh-button:disabled,
			.speak-button:disabled {
				opacity: 0.5;
				cursor: not-allowed;
				transform: none;
				background: rgba(102, 126, 234, 0.05);
			}

			.refresh-button .icon {
				transition: transform 0.3s ease;
			}

			.refresh-button:hover:not(:disabled) .icon {
				transform: rotate(90deg);
			}

			.speak-button {
				background: rgba(72, 187, 120, 0.1);
				color: var(--success-color);
				border-color: rgba(72, 187, 120, 0.2);
			}

			.speak-button:hover:not(:disabled) {
				background: rgba(72, 187, 120, 0.15);
				border-color: rgba(72, 187, 120, 0.4);
			}

			.speak-button:disabled {
				background: rgba(72, 187, 120, 0.05);
			}

			.speak-button.speaking {
				background: rgba(245, 101, 101, 0.1);
				color: var(--error-color);
				border-color: rgba(245, 101, 101, 0.2);
			}

			.speak-button.speaking:hover {
				background: rgba(245, 101, 101, 0.15);
				border-color: rgba(245, 101, 101, 0.4);
			}

			.content-main {
				font-size: 1.5rem;
				line-height: 1.8;
				margin-bottom: 1.5rem;
				color: var(--text-dark);
				font-weight: 500;
			}

			.content-interpretation {
				background: var(--bg-light);
				padding: 1.5rem;
				border-radius: 12px;
				margin-bottom: 1.5rem;
				border-left: 4px solid var(--primary-color);
			}

			.keywords-section {
				margin-top: 1.5rem;
			}

			.keywords-title {
				font-weight: 600;
				margin-bottom: 0.75rem;
				color: var(--text-dark);
			}

			.keywords-list {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
			}

			.keyword-tag {
				background: var(--gradient-primary);
				color: white;
				padding: 0.25rem 0.75rem;
				border-radius: 20px;
				font-size: 0.875rem;
				font-weight: 500;
			}

			.sidebar {
				display: flex;
				flex-direction: column;
				gap: 1.5rem;
			}

			.stats-card {
				background: var(--bg-white);
				border-radius: 16px;
				padding: 1.5rem;
				box-shadow: var(--shadow-md);
				border: 1px solid var(--border-color);
			}

			.stats-title {
				font-size: 1.1rem;
				font-weight: 600;
				margin-bottom: 1rem;
				color: var(--text-dark);
			}

			.stat-item {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0.5rem 0;
				border-bottom: 1px solid var(--border-color);
			}

			.stat-item:last-child {
				border-bottom: none;
			}

			.stat-label {
				color: var(--text-light);
				font-size: 0.9rem;
			}

			.stat-value {
				font-weight: 600;
				color: var(--primary-color);
			}

			.loading {
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 3rem;
				color: var(--text-light);
			}

			.spinner {
				width: 40px;
				height: 40px;
				border: 4px solid var(--border-color);
				border-left-color: var(--primary-color);
				border-radius: 50%;
				animation: spin 1s linear infinite;
				margin-right: 1rem;
			}

			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}

			.error-message {
				background: rgba(245, 101, 101, 0.1);
				color: var(--error-color);
				padding: 1rem;
				border-radius: 8px;
				text-align: center;
				margin: 1rem 0;
			}

			.cache-indicator {
				display: inline-flex;
				align-items: center;
				gap: 0.25rem;
				font-size: 0.875rem;
				color: var(--text-light);
				margin-left: 1rem;
			}

			@media (max-width: 768px) {
				.hero-title {
					font-size: 2.5rem;
				}

				.hero-subtitle {
					font-size: 1.1rem;
				}

				.landing-container {
					padding: 1rem;
				}

				.features-grid {
					grid-template-columns: 1fr;
					gap: 1rem;
				}

				.learning-tabs {
					justify-content: center;
				}

				.tab-button {
					flex: 1;
					justify-content: center;
					min-width: 120px;
				}

				.header-container {
					padding: 0 1rem;
					flex-direction: column;
					gap: 1rem;
				}

				.app-main {
					padding: 1rem;
				}

				.content-header {
					flex-direction: column;
					gap: 1rem;
					align-items: flex-start;
				}

				.header-actions {
					align-self: stretch;
					justify-content: space-between;
				}
			}

			@media (max-width: 480px) {
				.hero-title {
					font-size: 2rem;
				}

				.feature-card {
					padding: 1.5rem;
				}

				.content-main {
					font-size: 1.25rem;
				}

				.learning-tabs {
					flex-direction: column;
				}

				.tab-button {
					flex: none;
				}
			}
		</style>
	</head>
	<body>
		<div id="landingPage" class="landing-page">
			<div class="landing-container">
				<div class="hero-section">
					<h1 class="hero-title">ğŸ“š æ¯æ—¥å­¦ä¹ åŠ©æ‰‹</h1>
					<p class="hero-subtitle">åŸºäºè±†åŒ…å¤§æ¨¡å‹çš„æ™ºèƒ½å­¦ä¹ å†…å®¹æ¨èç³»ç»Ÿ</p>
					<p class="hero-description">
						æ¯å¤©ä¸ºå…¨çƒç”¨æˆ·æ¨é€ç²¾é€‰çš„è‹±è¯­è°šè¯­ã€ä¸­æ–‡å¤è¯—è¯å’Œä¸­åŒ»åŸºç¡€çŸ¥è¯†ï¼Œè®©å­¦ä¹ æˆä¸ºä¸€ç§ä¹ æƒ¯
					</p>
				</div>

				<div class="features-grid">
					<div
						class="feature-card"
						onclick="Router.navigate('/app/english')"
						style="cursor: pointer"
					>
						<div class="feature-icon">ğŸ‡ºğŸ‡¸</div>
						<h3 class="feature-title">è‹±è¯­è°šè¯­</h3>
						<p class="feature-desc">
							ä¼ ç»Ÿè°šè¯­ã€æ ¼è¨€ã€ä¹ è¯­ï¼Œæå‡è‹±è¯­ç†è§£èƒ½åŠ›å’Œæ–‡åŒ–ç´ å…»
						</p>
					</div>
					<div
						class="feature-card"
						onclick="Router.navigate('/app/chinese')"
						style="cursor: pointer"
					>
						<div class="feature-icon">ğŸ‡¨ğŸ‡³</div>
						<h3 class="feature-title">ä¸­æ–‡å¤è¯—è¯</h3>
						<p class="feature-desc">
							å¤è¯—ã€è¯ã€èµ‹ç­‰ä¼ ç»Ÿæ–‡åŒ–ç‘°å®ï¼Œä¼ æ‰¿ä¸­åæ–‡åŒ–ç²¾é«“
						</p>
					</div>
					<div
						class="feature-card"
						onclick="Router.navigate('/app/tcm')"
						style="cursor: pointer"
					>
						<div class="feature-icon">ğŸŒ¿</div>
						<h3 class="feature-title">ä¸­åŒ»åŸºç¡€</h3>
						<p class="feature-desc">
							ã€Šé»„å¸å†…ç»ã€‹ã€ã€Šä¼¤å¯’è®ºã€‹ç­‰ç»å…¸æ¡æ–‡ï¼Œäº†è§£ä¸­åŒ»ç†è®ºå’ŒåŸºç¡€çŸ¥è¯†
						</p>
					</div>
				</div>

				<button class="cta-button" onclick="enterApp()">
					<i class="fas fa-rocket"></i> å¼€å§‹å­¦ä¹ ä¹‹æ—…
				</button>
			</div>
		</div>

		<div id="appPage" class="app-page">
			<header class="app-header">
				<div class="header-container">
					<div class="app-logo" onclick="goHome()" style="cursor: pointer">
						<i class="fas fa-graduation-cap"></i>
						æ¯æ—¥å­¦ä¹ åŠ©æ‰‹
					</div>
					<div id="statusIndicator" class="status-indicator">
						<i class="fas fa-circle"></i>
						<span>æ£€æŸ¥ä¸­...</span>
					</div>
				</div>
			</header>

			<main class="app-main">
				<div class="learning-tabs">
					<button class="tab-button active" data-type="english">
						<i class="fas fa-globe-americas"></i>
						è‹±è¯­è°šè¯­
					</button>
					<button class="tab-button" data-type="chinese">
						<i class="fas fa-yin-yang"></i>
						ä¸­æ–‡å¤è¯—è¯
					</button>
					<button class="tab-button" data-type="tcm">
						<i class="fas fa-leaf"></i>
						ä¸­åŒ»åŸºç¡€
					</button>
				</div>

				<div class="learning-content">
					<div class="content-card">
						<div class="content-header">
							<div class="content-type" id="contentType">è‹±è¯­è°šè¯­</div>
							<div class="header-actions">
								<button
									class="speak-button"
									id="speakBtn"
									onclick="toggleSpeech()"
									style="display: none"
								>
									<i class="fas fa-volume-up"></i> æœ—è¯»
								</button>
								<button
									class="refresh-button"
									id="refreshBtn"
									onclick="loadContent(true)"
								>
									<i class="fas fa-sync-alt icon"></i> åˆ·æ–°
								</button>
							</div>
						</div>

						<div id="contentContainer">
							<div class="loading">
								<div class="spinner"></div>
								æ­£åœ¨åŠ è½½å†…å®¹...
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<script>
			const API_BASE = "https://everyday-study-backend.onrender.com/api";
			let currentType = "english";
			let isLoading = false;

			const typeNames = {
				english: "è‹±è¯­è°šè¯­",
				chinese: "ä¸­æ–‡å¤è¯—è¯",
				tcm: "ä¸­åŒ»åŸºç¡€",
			};

			const typeIcons = {
				english: "ğŸ‡ºğŸ‡¸",
				chinese: "ğŸ‡¨ğŸ‡³",
				tcm: "ğŸŒ¿",
			};

			const Router = {
				getCurrentRoute() {
					return window.location.hash.slice(1) || "/";
				},

				navigate(path) {
					window.location.hash = path;
				},

				parseRoute(route) {
					const parts = route.split("/").filter(Boolean);
					return {
						page: parts[0] || "home",
						type: parts[1] || "english",
					};
				},

				handleRoute() {
					const route = this.getCurrentRoute();
					const { page, type } = this.parseRoute(route);

					console.log("è·¯ç”±å˜åŒ–:", route, { page, type });

					if (page === "app") {
						this.showAppPage(type);
					} else {
						this.showHomePage();
					}
				},

				showHomePage() {
					document.getElementById("landingPage").style.display = "block";
					document.getElementById("appPage").style.display = "none";
					document.title = "æ¯æ—¥å­¦ä¹ åŠ©æ‰‹ - AI æ™ºèƒ½å­¦ä¹ å†…å®¹æ¨è";
				},

				showAppPage(type = "english") {
					document.getElementById("landingPage").style.display = "none";
					document.getElementById("appPage").style.display = "block";
					document.title = `${typeNames[type]} - æ¯æ—¥å­¦ä¹ åŠ©æ‰‹`;

					if (currentType !== type) {
						currentType = type;
						this.updateActiveTab(type);
						document.getElementById("contentType").textContent =
							typeNames[type];
					}

					if (!window.apiHealthChecked) {
						checkApiHealth();
						window.apiHealthChecked = true;
					}

					loadContent();
				},

				updateActiveTab(type) {
					document.querySelectorAll(".tab-button").forEach((btn) => {
						btn.classList.remove("active");
					});
					const activeBtn = document.querySelector(`[data-type="${type}"]`);
					if (activeBtn) {
						activeBtn.classList.add("active");
					}
				},

				init() {
					window.addEventListener("hashchange", () => {
						this.handleRoute();
					});

					this.handleRoute();
				},
			};

			const SpeechManager = {
				synthesis: window.speechSynthesis,
				currentUtterance: null,
				isSupported: "speechSynthesis" in window,

				init() {
					if (!this.isSupported) {
						console.warn("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½");
						return false;
					}
					return true;
				},

				speak(text, lang = "en-US") {
					if (!this.isSupported) {
						alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³æœ—è¯»åŠŸèƒ½");
						return;
					}

					this.stop();

					const utterance = new SpeechSynthesisUtterance(text);
					utterance.lang = lang;
					utterance.rate = 0.8;
					utterance.pitch = 1.0;
					utterance.volume = 1.0;

					utterance.onstart = () => {
						this.updateSpeakButton(true);
					};

					utterance.onend = () => {
						this.updateSpeakButton(false);
						this.currentUtterance = null;
					};

					utterance.onerror = (error) => {
						console.error("è¯­éŸ³åˆæˆé”™è¯¯:", error);
						this.updateSpeakButton(false);
						this.currentUtterance = null;
					};

					this.currentUtterance = utterance;
					this.synthesis.speak(utterance);
				},

				stop() {
					if (this.synthesis.speaking) {
						this.synthesis.cancel();
					}
					this.updateSpeakButton(false);
					this.currentUtterance = null;
				},

				toggle(text, lang = "en-US") {
					if (this.synthesis.speaking) {
						this.stop();
					} else {
						this.speak(text, lang);
					}
				},

				updateSpeakButton(isSpeaking) {
					const speakBtn = document.getElementById("speakBtn");
					if (!speakBtn) return;

					if (isSpeaking) {
						speakBtn.classList.add("speaking");
						speakBtn.innerHTML = '<i class="fas fa-stop"></i> åœæ­¢';
					} else {
						speakBtn.classList.remove("speaking");
						speakBtn.innerHTML = '<i class="fas fa-volume-up"></i> æœ—è¯»';
					}
				},
			};

			function toggleSpeech() {
				const content = window.currentEnglishContent;
				if (content) {
					SpeechManager.toggle(content);
				}
			}
			const CacheManager = {
				getTodayKey() {
					return new Date().toISOString().split("T")[0];
				},

				getCacheKey(type) {
					return `learning_content_${type}`;
				},

				saveContent(type, content) {
					try {
						const cacheData = {
							content: content,
							date: this.getTodayKey(),
							timestamp: Date.now(),
						};
						localStorage.setItem(
							this.getCacheKey(type),
							JSON.stringify(cacheData)
						);
					} catch (error) {
						console.warn("ä¿å­˜ç¼“å­˜å¤±è´¥:", error);
					}
				},

				getContent(type) {
					try {
						const cached = localStorage.getItem(this.getCacheKey(type));
						if (!cached) return null;

						const cacheData = JSON.parse(cached);
						const today = this.getTodayKey();

						if (cacheData.date === today) {
							return cacheData.content;
						} else {
							this.clearContent(type);
							return null;
						}
					} catch (error) {
						console.warn("è¯»å–ç¼“å­˜å¤±è´¥:", error);
						return null;
					}
				},

				clearContent(type) {
					try {
						localStorage.removeItem(this.getCacheKey(type));
					} catch (error) {
						console.warn("æ¸…é™¤ç¼“å­˜å¤±è´¥:", error);
					}
				},

				clearExpiredCache() {
					const today = this.getTodayKey();
					["english", "chinese", "tcm"].forEach((type) => {
						try {
							const cached = localStorage.getItem(this.getCacheKey(type));
							if (cached) {
								const cacheData = JSON.parse(cached);
								if (cacheData.date !== today) {
									this.clearContent(type);
								}
							}
						} catch (error) {
							console.warn(`æ¸…é™¤ ${type} è¿‡æœŸç¼“å­˜å¤±è´¥:`, error);
						}
					});
				},
			};

			function enterApp() {
				Router.navigate("/app/english");
			}

			function goHome() {
				Router.navigate("/");
			}

			async function checkApiHealth() {
				const statusIndicator = document.getElementById("statusIndicator");

				try {
					const response = await fetch(`${API_BASE}/health`);
					const data = await response.json();

					if (data.success) {
						statusIndicator.className = "status-indicator status-online";
						statusIndicator.innerHTML =
							'<i class="fas fa-circle"></i><span>æœåŠ¡æ­£å¸¸</span>';
					} else {
						throw new Error("API è¿”å›é”™è¯¯");
					}
				} catch (error) {
					statusIndicator.className = "status-indicator status-offline";
					statusIndicator.innerHTML =
						'<i class="fas fa-circle"></i><span>æœåŠ¡å¼‚å¸¸</span>';
					console.error("å¥åº·æ£€æŸ¥å¤±è´¥:", error);
				}
			}

			function switchType(type) {
				Router.navigate(`/app/${type}`);
			}

			async function loadContent(forceRefresh = false) {
				const refreshBtn = document.getElementById("refreshBtn");
				const contentContainer = document.getElementById("contentContainer");

				if (!forceRefresh) {
					const cachedContent = CacheManager.getContent(currentType);
					if (cachedContent) {
						console.log(`ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„${typeNames[currentType]}å†…å®¹`);
						cachedContent.from_cache = true;
						displayContent(cachedContent);
						return;
					}
				}

				if (isLoading) {
					console.log("æ­£åœ¨åŠ è½½ä¸­ï¼Œè·³è¿‡é‡å¤è¯·æ±‚");
					return;
				}

				isLoading = true;

				refreshBtn.disabled = true;
				refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­';

				contentContainer.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    æ­£åœ¨åŠ è½½ä»Šæ—¥${typeNames[currentType]}...
                </div>
            `;

				try {
					const response = await fetch(
						`${API_BASE}/today-learning/${currentType}`
					);
					const data = await response.json();

					if (data.success) {
						CacheManager.saveContent(currentType, data.data);
						displayContent(data.data);
						console.log(`ä»æœåŠ¡å™¨è·å–${typeNames[currentType]}å†…å®¹`);
					} else {
						throw new Error(data.message || "è·å–å†…å®¹å¤±è´¥");
					}
				} catch (error) {
					contentContainer.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        åŠ è½½å¤±è´¥ï¼š${error.message}
                        <br><small>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åå†è¯•</small>
                    </div>
                `;
					console.error("åŠ è½½å†…å®¹å¤±è´¥:", error);
				} finally {
					isLoading = false;
					refreshBtn.disabled = false;
					refreshBtn.innerHTML = '<i class="fas fa-sync-alt icon"></i> åˆ·æ–°';
				}
			}

			function displayContent(content) {
				const contentContainer = document.getElementById("contentContainer");
				const speakBtn = document.getElementById("speakBtn");
				const typeIcon = typeIcons[content.type] || "ğŸ“š";

				if (content.type === "english") {
					speakBtn.style.display = "flex";
					window.currentEnglishContent = content.content;
					SpeechManager.stop();
				} else {
					speakBtn.style.display = "none";
					window.currentEnglishContent = null;
					SpeechManager.stop();
				}

				let contentHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                    <span style="font-size: 1.5rem; margin-right: 0.5rem;">${typeIcon}</span>
                    <span style="font-weight: 600; color: var(--text-dark);">ä»Šæ—¥å†…å®¹</span>
                </div>
                <div class="content-main">${content.content}</div>
            `;

				if (content.interpretation) {
					contentHTML += `
                    <div class="content-interpretation">
                        <strong>é‡Šä¹‰ï¼š</strong>${content.interpretation}
                    </div>
                `;
				}

				if (content.key_words && content.key_words.length > 0) {
					contentHTML += `
                    <div class="keywords-section">
                        <div class="keywords-title">å…³é”®è¯è§£æ</div>
                        <div class="keywords-list">
                            ${content.key_words
															.map(
																(keyword) =>
																	`<span class="keyword-tag">${keyword}</span>`
															)
															.join("")}
                        </div>
                    </div>
                `;
				}

				contentContainer.innerHTML = contentHTML;
			}

			async function loadStats() {
				const statsContainer = document.getElementById("statsContainer");

				try {
					const response = await fetch(`${API_BASE}/stats`);
					const data = await response.json();

					if (data.success && data.data.stats) {
						displayStats(data.data.stats);
					} else {
						throw new Error("è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥");
					}
				} catch (error) {
					statsContainer.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        ç»Ÿè®¡æ•°æ®åŠ è½½å¤±è´¥
                    </div>
                `;
					console.error("åŠ è½½ç»Ÿè®¡å¤±è´¥:", error);
				}
			}

			function displayStats(stats) {
				const statsContainer = document.getElementById("statsContainer");

				const totalDays =
					(stats.english || 0) + (stats.chinese || 0) + (stats.tcm || 0);

				const statsHTML = `
                <div class="stat-item">
                    <span class="stat-label">è‹±è¯­è°šè¯­</span>
                    <span class="stat-value">${stats.english || 0} å¤©</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¸­æ–‡å¤è¯—è¯</span>
                    <span class="stat-value">${stats.chinese || 0} å¤©</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¸­åŒ»åŸºç¡€</span>
                    <span class="stat-value">${stats.tcm || 0} å¤©</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æ€»å­¦ä¹ å¤©æ•°</span>
                    <span class="stat-value">${totalDays} å¤©</span>
                </div>
            `;

				statsContainer.innerHTML = statsHTML;
			}

			document.querySelectorAll(".tab-button").forEach((button) => {
				button.addEventListener("click", () => {
					const type = button.dataset.type;
					switchType(type);
				});
			});

			setInterval(checkApiHealth, 30000);

			document.addEventListener("DOMContentLoaded", () => {
				CacheManager.clearExpiredCache();

				SpeechManager.init();

				Router.init();

				console.log("æ¯æ—¥å­¦ä¹ åŠ©æ‰‹å·²åŠ è½½å®Œæˆ");
			});
		</script>
	</body>
</html>
